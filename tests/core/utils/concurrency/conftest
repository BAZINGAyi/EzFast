import pytest
import sys
import os

# 添加项目根目录到Python路径
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(__file__))))
if project_root not in sys.path:
    sys.path.insert(0, project_root)

# Pytest配置
pytest_plugins = []

def pytest_configure(config):
    """Pytest配置函数。"""
    config.addinivalue_line(
        "markers", "slow: marks tests as slow (deselect with '-m \"not slow\"')"
    )
    config.addinivalue_line(
        "markers", "integration: marks tests as integration tests"
    )

# 测试发现配置
def pytest_collection_modifyitems(config, items):
    """修改测试收集行为。"""
    for item in items:
        # 为包含'performance'的测试添加slow标记
        if "performance" in item.name:
            item.add_marker(pytest.mark.slow)
        
        # 为复杂场景测试添加integration标记
        if "complex" in item.name or "mixed_scenario" in item.name:
            item.add_marker(pytest.mark.integration)
